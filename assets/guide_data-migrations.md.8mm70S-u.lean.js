import{_ as s,c as i,a2 as t,o as n}from"./chunks/framework.BBV1ZMcZ.js";const g=JSON.parse('{"title":"Data migrations","description":"","frontmatter":{},"headers":[],"relativePath":"guide/data-migrations.md","filePath":"guide/data-migrations.md"}'),e={name:"guide/data-migrations.md"};function p(l,a,h,d,r,o){return n(),i("div",null,a[0]||(a[0]=[t(`<h1 id="data-migrations" tabindex="-1">Data migrations <a class="header-anchor" href="#data-migrations" aria-label="Permalink to &quot;Data migrations&quot;">​</a></h1><p>You can easily generate data migrations for your database.</p><p>The data migrations are decoupled from your schema declaration, and you decide when to run them, before or after pushing your schema changes.</p><h2 id="generate-a-data-migration" tabindex="-1">Generate a data migration <a class="header-anchor" href="#generate-a-data-migration" aria-label="Permalink to &quot;Generate a data migration&quot;">​</a></h2><p>Generate a data migraion file with <a href="./cli/data/scaffold.html"><code>data scaffold</code></a> command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scaffold</span></span></code></pre></div><p>The data migration file exports two functions:</p><ul><li><p><code>up</code> for applying the data migration (with <a href="./cli/data/apply.html"><code>data apply</code></a> or <a href="./cli/data/up.html"><code>data up</code></a>)</p></li><li><p><code>down</code> to revert the data migration. (with <a href="./cli/data/down.html"><code>data down</code></a>)</p></li></ul><p>A <code>Kysely</code> client for the database is made available but you can import and use the client of your choice inside the function.</p><h2 id="applying-data-migrations" tabindex="-1">Applying data migrations <a class="header-anchor" href="#applying-data-migrations" aria-label="Permalink to &quot;Applying data migrations&quot;">​</a></h2><p>You can apply all pending data migrations with <a href="./cli/data/apply.html"><code>data apply</code></a> command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span></span></code></pre></div><p>You can apply a single pending data migrations with <a href="./cli/data/up.html"><code>data up</code></a> command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span></span></code></pre></div><h2 id="reverting-data-migrations" tabindex="-1">Reverting data migrations <a class="header-anchor" href="#reverting-data-migrations" aria-label="Permalink to &quot;Reverting data migrations&quot;">​</a></h2><p>You can revert an applied data migration with <a href="./cli/data/down.html"><code>data down</code></a> command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span></code></pre></div><h2 id="data-migrations-groups" tabindex="-1">Data migrations groups <a class="header-anchor" href="#data-migrations-groups" aria-label="Permalink to &quot;Data migrations groups&quot;">​</a></h2><p>By default, data migrations are placed and run in the data folder for your defined database: <code>monolayer/[database-id]/data/</code>.</p><p>Data migrations groups allows you to create different sets of data migrations that you can apply independently from each other.</p><p>You can create and use data migrations groups by using <code>-g</code> option on CLI commands.</p><h3 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h3><p>Let&#39;s say you want to have two sets of data migrations:</p><ul><li>One set to apply before pushing schema changes.</li><li>Another set to apply after pushing schema changes.</li></ul><h3 id="before-group" tabindex="-1">Before group <a class="header-anchor" href="#before-group" aria-label="Permalink to &quot;Before group&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Scaffold a data migration file in monolayer/[database-id]/data/before</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scaffold</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> before</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Revert a data migrations in monolayer/[database-id]/data/before</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> before</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Apply data migrations in monolayer/[database-id]/data/before</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> before</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get the data migrations status in monolayer/[database-id]/data/before</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> before</span></span></code></pre></div><h3 id="after-group" tabindex="-1">After group <a class="header-anchor" href="#after-group" aria-label="Permalink to &quot;After group&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Scaffold a data migration file in monolayer/[database-id]/data/after</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scaffold</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Revert a data migrations in monolayer/[database-id]/data/after</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Apply data migrations in monolayer/[database-id]/data/after</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get the data migrations status in monolayer/[database-id]/data/after</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monolayer-pg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span></span></code></pre></div>`,28)]))}const c=s(e,[["render",p]]);export{g as __pageData,c as default};
