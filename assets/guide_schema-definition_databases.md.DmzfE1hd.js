import{_ as s,c as i,a2 as e,o as t}from"./chunks/framework.BVrlcXZz.js";const c=JSON.parse('{"title":"Databases","description":"","frontmatter":{"prev":false},"headers":[],"relativePath":"guide/schema-definition/databases.md","filePath":"guide/schema-definition/databases.md"}'),n={name:"guide/schema-definition/databases.md"};function l(p,a,h,o,d,r){return t(),i("div",null,a[0]||(a[0]=[e(`<h1 id="databases" tabindex="-1">Databases <a class="header-anchor" href="#databases" aria-label="Permalink to &quot;Databases&quot;">​</a></h1><p><code>monolayer-pg</code> will be aware of all your <a href="./glossary.html#database">databases</a> through exported database defintions from a single databases file.</p><p>You can think of the databases file as the entrypoint for all the databases and schemas you want to manage with <code>monolayer-pg</code>.</p><p>As a starting point, you are given a default folder/file structure for the <code>db</code> folder and a <code>databases.ts</code> file it.</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>🗂️ &lt;project-root&gt;</span></span>
<span class="line"><span>└ 📁 &lt;chosen-db-location&gt;</span></span>
<span class="line"><span>  └ 📁 db</span></span>
<span class="line"><span>    ├ 📄 client.ts</span></span>
<span class="line"><span>    ├ 📄 databases.ts</span></span>
<span class="line"><span>    ├ 📄 schema.ts</span></span>
<span class="line"><span>    ├ 📄 seeds.ts</span></span></code></pre></div><p>However, you can move and rename files as you see fit and modularize your code to your own conventions.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Don&#39;t forget to update the <a href="./../configuration.html">configuration</a> in <code>monolayer.config.ts</code>, when the change your databases file name or its location.</p></div><h2 id="define-a-single-database" tabindex="-1">Define a single database <a class="header-anchor" href="#define-a-single-database" aria-label="Permalink to &quot;Define a single database&quot;">​</a></h2><p>After importing <a href="./../../reference/api/schema/functions/defineDatabase.html"><code>defineDatabase</code></a> from <code>@monolayer/pg/schema</code>, you export a default database definition.</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-ctuKU" id="tab-8xaxtAZ" checked><label data-title="databases.ts" for="tab-8xaxtAZ">databases.ts</label></div><div class="blocks"><div class="language-ts vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineDatabase } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@monolayer/pg/schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { dbSchema } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  schemas: [dbSchema], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Schemas in the database</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Other configuration options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div></div></div><p>See the list of config options in the <a href="./../../reference/api/schema/type-aliases/PgDatabaseConfig.html">PgDatabaseConfig Reference</a>.</p><h2 id="define-multiple-databases" tabindex="-1">Define multiple databases <a class="header-anchor" href="#define-multiple-databases" aria-label="Permalink to &quot;Define multiple databases&quot;">​</a></h2><p>To define multiple databases, you export more than one database definition from the databases file.</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-ddZYN" id="tab-aagyZzW" checked><label data-title="databases.ts" for="tab-aagyZzW">databases.ts</label></div><div class="blocks"><div class="language-ts vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineDatabase } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@monolayer/pg/schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Database configuration options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stats&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Other database configuration options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div></div></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>When you define multiple databases, make sure each database definition has a <a href="#database-identifiers">unique identifier</a>. Otherwise, you will have multiple databases with the same <code>default</code> identifier.</p></div><p>You can also re-export databases from other files.</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-YTx1J" id="tab-DaU6fEH" checked><label data-title="databases.ts" for="tab-DaU6fEH">databases.ts</label><input type="radio" name="group-YTx1J" id="tab-nHIFuVo"><label data-title="stats.ts" for="tab-nHIFuVo">stats.ts</label></div><div class="blocks"><div class="language-ts vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineDatabase } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@monolayer/pg/schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { statsDb } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./stats&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Database configuration options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineDatabase } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@monolayer/pg/schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { statsSchema } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./stats-schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stats&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  schemas: [statsSchema],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Other database configuration options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div></div></div><h2 id="database-identifiers" tabindex="-1">Database identifiers <a class="header-anchor" href="#database-identifiers" aria-label="Permalink to &quot;Database identifiers&quot;">​</a></h2><p>Each database has a configurable unique identifier (<code>id</code>), and the default <code>id</code> is <code>default</code>.</p><p>The unique identifier is used internally by <code>monolayer-pg</code> to resolve:</p><ol><li>The current database context when running CLI commands.</li><li>The environment variable name that will contain the database connection URL.</li></ol><h2 id="database-connection-url" tabindex="-1">Database connection URL <a class="header-anchor" href="#database-connection-url" aria-label="Permalink to &quot;Database connection URL&quot;">​</a></h2><p>Based on the defined database <code>id</code>, <code>monolayer-pg</code> will be able to connect to the database by fetching the database connection URL from an environment variable in the format: <code>MONO_PG_\${DATABASE_ID_TO_SNAKE_CASE_AND_UPPER_CASE}_DATABASE_URL</code>.</p><div class="info custom-block"><p class="custom-block-title">EXAMPLE</p><p>For a database with the unique identifier <code>user_stats</code>, the expected environment variable containing the database connection URL is: <strong><code>MONO_PG_USER_STATS_DATABASE_URL</code></strong>.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>monolayer-pg</code> will also try to fetch environment variable from the <code>.env</code> file in your project root, if present.</p></div><p>Read more about database connection URLs in the <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING-URIS" target="_blank" rel="noreferrer">PostgreSQL Documentation</a></p>`,26)]))}const g=s(n,[["render",l]]);export{c as __pageData,g as default};
